import unittest
from datetime import date
from UST import UST, UST_Future
from _datetime import timedelta

def main():
    stlDate=date(2017,1,3)
    #stlDate=date.today()-timedelta(1)
    b1=UST(date(2019,6,30),stlDate,0.01625,2)
    b2=UST(date(2021,11,30),stlDate,0.0175,2)
    b3=UST(date(2024,5,15),stlDate,0.025,2)
    b4=UST(date(2019,9,30),stlDate,0.0175,2)
    b5=UST(date(2022,2,28),stlDate,0.01875,2)
    b6=UST(date(2024,8,15),stlDate,0.02375,2)
    b7=UST(date(2027,2,15),stlDate,0.0225,2)
    b8=UST(date(2027,5,15),stlDate,0.02375,2)
    matDates=(date(2017,12,18),date(2018,3,18),date(2018,6,19),date(2018,9,18))
    matRates=(98.685,98.6,98.54,98.49)
    TUU7=UST_Future(b1,date(2017,10,5),date(2017,9,1),1)
    FVU7=UST_Future(b2,date(2017,10,5),date(2017,9,1),1)
    TYU7=UST_Future(b3,date(2017,9,29),date(2017,9,1),2)
    TUZ7=UST_Future(b4,date(2018,1,5),date(2017,12,1),1)
    FVZ7=UST_Future(b5,date(2018,1,5),date(2017,12,1),1)
    TYZ7=UST_Future(b6,date(2017,12,29),date(2017,12,1),2)
    TNU7=UST_Future(b7,date(2017,9,29),date(2017,9,1),2)
    TNZ7=UST_Future(b8,date(2018,12,29),date(2017,12,1),2)
    TUU7Crv=TUU7.dfcurve(date(2017,9,11), date(2017,9,12), 0.012, matDates, matRates)
    print(TUU7Crv)
    print(TUU7.bprFromDFCurve(TUU7Crv, stlDate))
    print(TUU7.bimprepo(100.5, 108, date(2017,9,29)))
    #print('b1 previous coupon date',b1.prevCpn(stlDate))
    #print('b1 next coupon date',b1.nextCpn(stlDate))
    #print('b1 number of coupons remaining:',b1.numCoupons('A/A'))
    #print('b1 CF',TUU7.getCF(date(2017,9,1), 1))
    #print('b1 ai',b1.bai(b1.cpn, b1.matDate, b1.stlDate))
    #print('b1 yield',b1.byld(100))
    
    '''
    print('b1 DV01',b1.dv01(0.01424)*10000)
    print('b2 previous coupon date',b2.prevCpn(stlDate))
    print('b2 next coupon date',b2.nextCpn(stlDate))
    print('b2 number of coupons remaining:',b2.numCoupons('A/A'))
    print('b2 CF',FVU7.getCF(date(2017,9,1), 1))
    print('b2 ai',b2.bai(b2.cpn, b2.matDate, b2.stlDate))
    print('b2 yield',b2.byld(100))
    print('b3 previous coupon date',b3.prevCpn(stlDate))
    print('b3 next coupon date',b3.nextCpn(stlDate))
    print('b3 number of coupons remaining:',b3.numCoupons('A/A'))
    print('b3 CF',TYU7.getCF(date(2017,9,1), 2))
    print('b3 yield',b3.byld(100))
    print('b4 previous coupon date',b4.prevCpn(stlDate))
    print('b4 next coupon date',b4.nextCpn(stlDate))
    print('b4 number of coupons remaining:',b4.numCoupons('A/A'))
    print('b4 CF',TUZ7.getCF(date(2017,12,1), 1))
    print('b4 yield',b4.byld(100))
    print('b5 previous coupon date',b5.prevCpn(stlDate))
    print('b5 next coupon date',b5.nextCpn(stlDate))
    print('b5 number of coupons remaining:',b5.numCoupons('A/A'))
    print('b5 CF',FVZ7.getCF(date(2017,12,1), 1))
    print('b5 yield',b5.byld(100))
    print('b6 previous coupon date',b6.prevCpn(stlDate))
    print('b6 next coupon date',b6.nextCpn(stlDate))
    print('b6 number of coupons remaining:',b6.numCoupons('A/A'))
    print('b6 CF',TYZ7.getCF(date(2017,12,1), 2))
    print('b6 yield',b6.byld(100))
    print('b7 CF',TNU7.getCF(date(2017,9,1), 2))
    print('b7 yield',b7.byld(100))
    print('b8 CF',TNZ7.getCF(date(2017,12,1), 2))
    print('b8 yield',b8.byld(100))
    '''
    
if __name__=="__main__":
    main()
